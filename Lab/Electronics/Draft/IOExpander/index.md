---
title: I2C IOエクスパンダ MCP23017 の使い方
---

## MCP23017

- I2C 通信で GPIO ピンを拡張する
- 割り込み出力がある

[秋月電子](https://akizukidenshi.com/catalog/g/gI-09486/)

[参考：MCP23008 のデータシート](http://ww1.microchip.com/downloads/cn/DeviceDoc/cn026496.pdf)

## レジスタ

全て 8bit のレジスタです。それぞれのレジスタについて、A/B があります。レジスタの 8bit が 8 本の GPIO ピンに対応しています。

| 名前    |     | 機能                                 | 値                     |     |
| ------- | --- | ------------------------------------ | ---------------------- | --- |
| IODIR   | RW  | 入力か出力か？                       | 1:入力 0:出力          |     |
| IPOL    | RW  | 入力ピンの極性                       | 1:反転 0:同じ          |     |
| GPINTEN | RW  | 入力状態変化時に割り込みを起こすか？ | 1:割り込み有 0:無      |     |
| DEFVAL  | RW  | 割り込みの比較値                     |                        |     |
| INTCON  | RW  | 割り込みの比較値                     | 1:DEFVAL の値 0:前の値 |     |
| IOCON   | RW  | I2C の設定                           |                        |     |
| GPPU    | RW  | 入力ピンのプルアップ (100kΩ) を設定  | 1:プルアップ有 0:無    |     |
| INTF    | R   | 割り込みの状態                       |                        |     |
| INTCAP  | R   | 割り込み発生時のキャプチャ値         |                        |     |
| GPIO    | RW  | 入力値/出力値                        |                        |     |
| OLAT    | RW  | 出力ラッチ                           |                        |     |

### IOCON

| ビットの名前 | 機能                                                           |
| ------------ | -------------------------------------------------------------- |
| SEQOP        | シーケンシャル動作                                             |
|              | （I2C の通信回数に応じて、レジスタアドレスポインタを増分する） |
| DISSLW       | SDA 出力スルーレート設定                                       |
|              | （パルスのカーブを急峻にするので基本許可でいい）               |
| HAEN         | （MCP23S08 のみ）A2,A1 ピンでハードウェアアドレスを変更する    |
| ODR          | INT ピン（割り込み出力）をオープンドレインにする               |
| INTPOL       | INT ピンの極性                                                 |

## 簡単な使い方

割り込みを使わなければ簡単に使えるはずです。

### デバイスアドレス

A2,A1,A0 ピンでアドレスを設定します。

アドレスは 0b0100[a2][a1][a0]になります。

今回は全部 LOW に設定するので、0b0100000。

### 設定レジスタ

1. GPINTEN = 0 （割り込みは起こさない）
2. IOCON =
   1. SEQOP = 1 （I2C のレジスタアドレスは自動で増分しない）
   2. DISSLW = 0
   3. ODR = 0 （INT ピンは使わない）
   4. INTPOL = 0

### 出力

ピンを出力に設定

IODIR = 0

したうえで、

GPIO レジスタに出力値を送るとピンから出力されます。

### 入力

ピンを入力に設定

IODIR = 1

入力ピンのプルアップを設定

GPPU = 1

したうえで、

GPIO レジスタの値を読むと入力値を取得できます。

## テスト

Arduino でテストします。

FPGA でテストします。
